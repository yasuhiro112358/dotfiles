# ADR 作成

現在の作業コンテキストに基づき、Architecture Decision Record（ADR）を作成する。
`/doc` から委譲された場合も、直接呼び出された場合もこのファイルの手順に従う。

## ステップ1: ディレクトリ準備

```bash
# 配置先ディレクトリの存在確認。なければ作成する
ls docs/40_adr/ 2>/dev/null || mkdir -p docs/40_adr/

# 最新連番を確認し、次の番号を割り当てる
ls docs/40_adr/ | sort | tail -5
```

## ステップ2: ADR の作成

以下の品質原則を制約として守りながら作成する。

| 原則 | 内容 |
|------|------|
| Single Purpose | 技術選択の根拠・代替案・トレードオフのみを記述する |
| ADR-Based Decisions | この文書自体が ADR であるため、決定内容を明確に記録する |
| Single Source of Truth | 既存 ADR と重複しないか確認し、必要なら既存 ADR を更新する |
| Template-Driven Creation | 以下のテンプレートに沿って作成し、実際の内容で埋める |
| シークレット不在 | 環境変数・パスワード・トークン等をリポジトリに記載しない |

**ファイル名**: `docs/40_adr/adr-NNNN-<kebab-case-title>.md`（連番4桁）

**テンプレート**:
```markdown
# ADR NNNN: <タイトル（何を決めたか）>

- **日付**: YYYY-MM-DD
- **ステータス**: 承認
- **決定者**: （担当者名）
- **参照**: （関連する ADR があれば記載）

## 背景

（なぜこの決定が必要になったか。問題・制約・背景を記述）

## 選択肢

### A) <選択肢名>（採用 or 不採用）
- **利点**: ...
- **欠点**: ...

### B) <選択肢名>（採用 or 不採用）
- **利点**: ...
- **欠点**: ...

## 決定

（採用した選択肢と、その理由を明記）

## 影響 / トレードオフ

（この決定によって生じる影響・妥協点）

## フォローアップ

（この決定に伴って必要な後続タスク）
```

## ステップ3: 品質自己チェック

作成したドキュメントに対して以下を確認する。**すべてパスしてから**ステップ4に進む。

| チェック項目 | 確認内容 |
|-------------|---------|
| Single Purpose | 技術選択の記録のみで、手順や仕様が混在していないか |
| ADR-Based Decisions | 選択肢・決定・根拠が明記されているか |
| Single Source of Truth | 既存 ADR に同じ内容がないか |
| Template-Driven | テンプレート構成に沿い、プレースホルダーが残っていないか |
| 配置先ディレクトリ | `docs/40_adr/` に配置されているか |
| 命名規則 | `adr-NNNN-<title>.md` 形式（4桁連番）か |
| シークレット不在 | 機密情報が含まれていないか |
| Mermaid 形式 | 図がある場合、画像ファイルではなく Mermaid で記述されているか |

チェック結果は「✅ 全項目パス」または「⚠️ 修正済み（修正内容）」と明記する。

## ステップ4: 報告

- 作成したファイルのパスをユーザーに報告する
- ステップ3のチェック結果を報告する
- セキュリティ関連の決定を記録した場合はユーザーへレビュー依頼を行う

## 注意事項

- リポジトリへのシークレット記載は絶対に行わない
- 既存 ADR が近い内容をカバーしている場合は新規作成せず更新する
- 作成するドキュメントは現在の作業コンテキストに即した具体的な内容にする（テンプレートをそのまま出力しない）
