# 要件定義書 作成・更新

現在の作業コンテキストに基づき、要件定義書を作成・更新する。
`/doc` から委譲された場合も、直接呼び出された場合もこのファイルの手順に従う。

## ステップ1: ディレクトリ準備と既存ファイルの確認

```bash
# 配置先ディレクトリの存在確認。なければ作成する
ls docs/10_requirements/ 2>/dev/null || mkdir -p docs/10_requirements/

# 既存ファイルを確認（更新対象か新規作成かを判断）
ls docs/10_requirements/
```

既存ファイルが対象内容をカバーしている場合は**新規作成せず更新**する。

## ステップ2: 要件定義書の作成・更新

以下の品質原則を制約として守りながら作成する。

| 原則 | 内容 |
|------|------|
| Single Purpose | ゴール・スコープ・ユースケース・制約のみを記述する。実装詳細・設計内容は含まない |
| ADR-Based Decisions | 要件に基づく技術選択がある場合、対応する ADR が存在するか確認する |
| Single Source of Truth | 機能仕様の詳細は `docs/20_specs/` に委ねる。ここには「何を達成するか」のみ記述する |
| Template-Driven Creation | 以下のテンプレートに沿って作成し、実際の内容で埋める |
| シークレット不在 | 環境変数・パスワード・トークン等をリポジトリに記載しない |

**ファイル名**: `docs/10_requirements/<topic>-requirements.md`（kebab-case）

**テンプレート**:
```markdown
# <機能・システム名> 要件定義

## ゴール

（この機能・システムが達成すべき目的を1〜3行で記述）

## スコープ

**対象**:
- ...

**対象外**:
- ...

## ユースケース

### UC-01: <ユースケース名>

- **アクター**: （誰が）
- **事前条件**: （前提となる状態）
- **メインフロー**: （正常な操作の流れ）
- **代替フロー**: （例外・エラー時の流れ）

### UC-02: <ユースケース名>

...

## 制約

- **機能的制約**: ...
- **非機能的制約**: （パフォーマンス・セキュリティ・可用性等）
- **外部制約**: （法規制・サードパーティ制限等）
```

## ステップ3: 品質自己チェック

| チェック項目 | 確認内容 |
|-------------|---------|
| Single Purpose | ゴール・スコープ・制約のみで、実装詳細・設計が混在していないか |
| ADR-Based Decisions | 要件に基づく技術選択があれば対応する ADR が存在するか |
| Single Source of Truth | 機能仕様の詳細は specs に委ねており、重複記述していないか |
| Template-Driven | テンプレート構成に沿い、プレースホルダーが残っていないか |
| 配置先ディレクトリ | `docs/10_requirements/` に配置されているか |
| 命名規則 | `<topic>-requirements.md` 形式（kebab-case）か |
| シークレット不在 | 機密情報が含まれていないか |
| Mermaid 形式 | 図がある場合、画像ファイルではなく Mermaid で記述されているか |

チェック結果は「✅ 全項目パス」または「⚠️ 修正済み（修正内容）」と明記する。

## ステップ4: 報告

- 作成・更新したファイルのパスをユーザーに報告する
- ステップ3のチェック結果を報告する

## 注意事項

- 「どうやって実現するか」は記述しない。それは Design ドキュメントや ADR へ
- 作成するドキュメントは現在の作業コンテキストに即した具体的な内容にする（テンプレートをそのまま出力しない）
