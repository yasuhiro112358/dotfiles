# 機能仕様書 作成・更新

現在の作業コンテキストに基づき、機能仕様書（Functional Specification）を作成または更新する。
`/doc` から委譲された場合も、直接呼び出された場合もこのファイルの手順に従う。

## ステップ1: ディレクトリ準備と既存仕様書の確認

```bash
# 配置先ディレクトリの存在確認。なければ作成する
ls docs/20_specs/ 2>/dev/null || mkdir -p docs/20_specs/

# 既存の仕様書を確認（更新対象か新規作成かを判断）
ls docs/20_specs/
```

既存の仕様書が対象機能をカバーしている場合は**新規作成せず更新**する。

## ステップ2: 機能仕様書の作成・更新

以下の品質原則を制約として守りながら作成する。

| 原則 | 内容 |
|------|------|
| Single Purpose | ユーザー向けの振る舞い・例外処理・受け入れ基準のみを記述し、実装詳細を含まない |
| ADR-Based Decisions | 仕様に関連する設計判断が ADR に記録されているか確認する |
| Single Source of Truth | 既存仕様書の内容と重複しない。同一機能の仕様は1ファイルにまとめる |
| Template-Driven Creation | 以下のテンプレートに沿って作成し、実際の内容で埋める |
| シークレット不在 | 環境変数・パスワード・トークン等をリポジトリに記載しない |

**ファイル名**: `docs/20_specs/<feature-name>.md`（kebab-case）
新機能を既存ファイルへ追記する場合はファイル名変更不要。

**テンプレート**:
```markdown
# <機能名> 機能仕様

## 概要

（この機能が何を実現するか。ユーザー視点で1〜3行で記述）

## 対象ユーザー

- （この機能を使うユーザー・ロールを記述）

## 機能詳細

### <機能項目1>

**振る舞い**: （正常ケースのユーザー向け動作を記述）

**例外処理**:
- （エラーケース1）: （対処・メッセージ）
- （エラーケース2）: （対処・メッセージ）

**受け入れ基準**:
- [ ] ...
- [ ] ...

### <機能項目2>

...

## 制約・前提

- （この機能が依存する前提条件や制約を記述）
```

## ステップ3: 品質自己チェック

作成・更新したドキュメントに対して以下を確認する。**すべてパスしてから**ステップ4に進む。

| チェック項目 | 確認内容 |
|-------------|---------|
| Single Purpose | ユーザー向け振る舞いのみで、実装詳細・運用手順が混在していないか |
| ADR-Based Decisions | 仕様に関連する設計判断が必要なら ADR が存在するか |
| Single Source of Truth | 既存仕様書と重複していないか |
| Template-Driven | テンプレート構成に沿い、プレースホルダーが残っていないか |
| 配置先ディレクトリ | `docs/20_specs/` に配置されているか |
| 命名規則 | kebab-case か |
| シークレット不在 | 機密情報が含まれていないか |
| Mermaid 形式 | 図がある場合、画像ファイルではなく Mermaid で記述されているか |

チェック結果は「✅ 全項目パス」または「⚠️ 修正済み（修正内容）」と明記する。

## ステップ4: 報告

- 作成・更新したファイルのパスをユーザーに報告する
- ステップ3のチェック結果を報告する

## 注意事項

- 実装詳細（クラス名・関数名・DB スキーマ等）は記述しない。それらは Design ドキュメントへ
- 作成するドキュメントは現在の作業コンテキストに即した具体的な内容にする（テンプレートをそのまま出力しない）
