# Runbook 作成

現在の作業コンテキストに基づき、運用手順書（Runbook）を作成する。
`/doc` から委譲された場合も、直接呼び出された場合もこのファイルの手順に従う。

## ステップ1: ディレクトリ準備

```bash
# 配置先ディレクトリの存在確認。なければ作成する
ls docs/50_runbook/ 2>/dev/null || mkdir -p docs/50_runbook/

# 既存の類似ファイルを確認（重複がないか）
ls docs/50_runbook/
```

## ステップ2: Runbook の作成

以下の品質原則を制約として守りながら作成する。

| 原則 | 内容 |
|------|------|
| Single Purpose | 1ファイル1手順トピックに絞る（デプロイ・インシデント対応・メンテナンスなどを混在させない） |
| ADR-Based Decisions | 手順の背景にある設計判断が ADR に記録されているか確認する |
| Single Source of Truth | 既存 Runbook の内容と重複しない。重複なら既存ファイルを更新する |
| Template-Driven Creation | 以下のテンプレートに沿って作成し、実際の内容で埋める |
| シークレット不在 | 環境変数・パスワード・トークン等をリポジトリに記載しない |

**ファイル名**: `docs/50_runbook/<topic>.md`（kebab-case）

**テンプレート**:
```markdown
# <サービス名・トピック> 運用手順

## 概要

（何のための手順か、対象コンポーネントを1〜3行で記述）

## 前提

- （必要なツール・権限・事前条件を箇条書き）

## 手順

### 1) <ステップ名>

```bash
# コマンド例
```

（補足説明があれば記述）

### 2) <ステップ名>

...

## トラブルシューティング

| 症状 | 原因 | 対処 |
|------|------|------|
| ... | ... | ... |
```

## ステップ3: 品質自己チェック

作成したドキュメントに対して以下を確認する。**すべてパスしてから**ステップ4に進む。

| チェック項目 | 確認内容 |
|-------------|---------|
| Single Purpose | 単一のトピック・手順に絞られているか |
| ADR-Based Decisions | 手順に関連する設計判断が必要なら ADR が存在するか |
| Single Source of Truth | 既存 Runbook と重複していないか |
| Template-Driven | テンプレート構成に沿い、プレースホルダーが残っていないか |
| 配置先ディレクトリ | `docs/50_runbook/` に配置されているか |
| 命名規則 | kebab-case か |
| シークレット不在 | 機密情報・本番認証情報が含まれていないか |
| Mermaid 形式 | 図がある場合、画像ファイルではなく Mermaid で記述されているか |

チェック結果は「✅ 全項目パス」または「⚠️ 修正済み（修正内容）」と明記する。

## ステップ4: 報告

- 作成したファイルのパスをユーザーに報告する
- ステップ3のチェック結果を報告する
- 本番運用手順を作成した場合はユーザーへレビュー依頼を行う

## 注意事項

- リポジトリへのシークレット記載は絶対に行わない
- 既存 Runbook が近い内容をカバーしている場合は新規作成せず更新する
- 作成するドキュメントは現在の作業コンテキストに即した具体的な内容にする（テンプレートをそのまま出力しない）
